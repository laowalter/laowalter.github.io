<!DOCTYPE html>
<html>
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie-edge">

    
    
    
    <link rel="stylesheet" href="/sass/main.min.b0163ad78a5d83e2d8dee2c2f33fa8b557711f0eb2b1ae412eca8874b7bfb72e.css">

</head>

    
<head>
    
    

    
    
    
    <link href="/css/section_number/section_number.css" rel="stylesheet" type="text/css">
    
</head>

    <body>
       <div class="homepage-header">
          <div class="homepage-left">
            <h1>Wifi-Bridge</h1> 
            <p class="datetime">Thu, Nov 16, 2017</p>
            <a class="tag tag--primary tag--small"   href="/"><font color="green">Home</font></a>

            
                
                    
                    <a class="tag tag--primary tag--small" href="/tags/gentoo">gentoo</a>
                
                    
                    <a class="tag tag--primary tag--small" href="/tags/wifi">wifi</a>
                
            
          </div>
      </div>

    <hr><br><nav id="TableOfContents">
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#package-prepare">Package prepare</a></li>
<li><a href="#configuration">Configuration</a>
<ul>
<li><a href="#etc-conf-d-net">/etc/conf.d/net</a></li>
<li><a href="#etc-wpa-supplicant-wpa-supplicant-conf">/etc/wpa_supplicant/wpa_supplicant.conf</a></li>
<li><a href="#etc-conf-d-wpa-supplicant">/etc/conf.d/wpa_supplicant</a></li>
</ul></li>
<li><a href="#reboot">Reboot</a></li>
</ul></li>
</ul>
</nav><article>
    

<h2 id="description">Description</h2>

<ol>
<li>The device(Mac mini) has a wired(<code>eth0</code>) interface and a wifi(<code>wlan0</code>) interface;</li>
<li><code>eth0</code> connected to lan with a static ip address, while<code>wlan0</code> is used as an access point(<code>ap</code>);</li>
<li>Wireless device, such as iphone will  connected to lan through <code>wlan0</code> by access the <code>ap</code></li>
</ol>

<h2 id="package-prepare">Package prepare</h2>

<p><code>Notice</code>: Be sure to set use=&lsquo;ap &hellip;&rsquo;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">emerge -avq net-wireless/wpa_supplicant
emerge -avq net-misc/bridge-utils</code></pre></div>
<h2 id="configuration">Configuration</h2>

<h3 id="etc-conf-d-net">/etc/conf.d/net</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#75715e"># The bridge will take the ip address, so the individual interfaces don&#39;t need any</span>
config_eth0<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;null&#34;</span>
config_wlan0<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;null&#34;</span>

modules_wlan0<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;wpa_supplicant&#34;</span>
wpa_supplicant_wlan0<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-b br0 -Dnl80211 -d -f /var/log/wpa_supplicant.log&#34;</span>

<span style="color:#75715e"># Setup bridge</span>
bridge_br0<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;eth0&#34;</span>
rc_net_br0_need<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;net.eth0&#34;</span>

<span style="color:#75715e">#config_br0=&#34;dhcp&#34;</span>
config_br0<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;192.168.0.199/24&#34;</span>
routes_br0<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;default via 192.168.0.1&#34;</span>

rc_net_wlan0_provide<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;!net&#34;</span>

<span style="color:#75715e"># Use the new method to configure bridge parameters</span>
bridge_stp_state_br0<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1&#34;</span>
bridge_hello_time_br0<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;100&#34;</span>

<span style="color:#75715e"># So instead we use the postup script to add wlan0 to the bridge after it is up</span>
postup() {
  <span style="color:#66d9ef">if</span>  [[ ${IFACE} <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;wlan0&#34;</span> ]]; <span style="color:#66d9ef">then</span>
    ebegin <span style="color:#e6db74">&#34;Adding ${IFACE} to bridge&#34;</span>;
    <span style="color:#e6db74">/sbin/</span>brctl addif br0 wlan0
    eend $?
  fi
  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}</code></pre></div>
<h3 id="etc-wpa-supplicant-wpa-supplicant-conf">/etc/wpa_supplicant/wpa_supplicant.conf</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#75715e"># update_config=1</span>
ctrl_interface<span style="color:#f92672">=</span>DIR<span style="color:#f92672">=</span><span style="color:#e6db74">/var/</span>run<span style="color:#f92672">/</span>wpa_supplicant GROUP<span style="color:#f92672">=</span>wheel
ap_scan<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
fast_reauth<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>

network<span style="color:#f92672">=</span>{
        ssid<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Bridge Test&#34;</span>
        psk<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;password&#34;</span>
        proto<span style="color:#f92672">=</span>WPA2
        key_mgmt<span style="color:#f92672">=</span>WPA<span style="color:#f92672">-</span>PSK
        group<span style="color:#f92672">=</span>CCMP
        priority<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>
        mode<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
        frequency<span style="color:#f92672">=</span><span style="color:#ae81ff">2462</span>
}</code></pre></div>
<h3 id="etc-conf-d-wpa-supplicant">/etc/conf.d/wpa_supplicant</h3>

<p>No change, use default</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#75715e"># Please check man 8 wpa_supplicant for more information about the options</span>
<span style="color:#75715e"># wpa_supplicant accepts.</span>

wpa_supplicant_args<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-B -M -c/etc/wpa_supplicant/wpa_supplicant.conf&#34;</span></code></pre></div>
<h2 id="reboot">Reboot</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ln -s /etc/init.d/net.lo /etc/init.d/net.eth0
ln -s /etc/init.d/net.lo /etc/init.d/net.wlan0
ln -s /etc/init.d/net.lo /etc/init.d/net.br0
rc-update add net.br0 default
rc-update add net.wlan0 default</code></pre></div>
</article>

    </body>
</html>
