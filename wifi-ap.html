<!DOCTYPE html>

<html lang="en-US">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="Walter" name="author">
<meta content="Walter" name="copyright">
<meta content="article" property="og:type">
<meta content="summary" name="twitter:card"/>
<meta content="Gentoo wifi, Tech, " name="keywords">
<meta content="WIFI-AP " property="og:title"/>
<meta content="./wifi-ap.html" property="og:url"/>
<meta content="Check hardware lspci -n | grep 14e4 Kernel config CONFIG_WLAN_VENDOR_BROADCOM=y CONFIG_B43=m CONFIG_B43_BCMA=y CONFIG_B43_SSB=y CONFIG_B43_BUSES_BCMA_AND_SSB=y # CONFIG_B43_BUSES_BCMA is not set # CONFIG_B43_BUSES_SSB is not set CONFIG_B43_PCI_AUTOSELECT=y CONFIG_B43_PCICORE_AUTOSELECT=y CONFIG_B43_SDIO=y CONFIG_B43_BCMA_PIO=y CONFIG_B43_PIO=y CONFIG_B43_PHY_G=y CONFIG_B43_PHY_N=y CONFIG_B43_PHY_LP=y CONFIG_B43_PHY_HT=y CONFIG_B43_HWRNG=y # CONFIG_B43_DEBUG is not set …" property="og:description"/>
<meta content="Just MEMO" property="og:site_name"/>
<meta content="Walter" property="og:article:author"/>
<meta content="2017-11-16T16:55:00+08:00" property="og:article:published_time"/>
<meta content="2018-03-15T10:43:53+08:00" property="og:article:modified_time"/>
<meta content="WIFI-AP " name="twitter:title"/>
<meta content="Check hardware lspci -n | grep 14e4 Kernel config CONFIG_WLAN_VENDOR_BROADCOM=y CONFIG_B43=m CONFIG_B43_BCMA=y CONFIG_B43_SSB=y CONFIG_B43_BUSES_BCMA_AND_SSB=y # CONFIG_B43_BUSES_BCMA is not set # CONFIG_B43_BUSES_SSB is not set CONFIG_B43_PCI_AUTOSELECT=y CONFIG_B43_PCICORE_AUTOSELECT=y CONFIG_B43_SDIO=y CONFIG_B43_BCMA_PIO=y CONFIG_B43_PIO=y CONFIG_B43_PHY_G=y CONFIG_B43_PHY_N=y CONFIG_B43_PHY_LP=y CONFIG_B43_PHY_HT=y CONFIG_B43_HWRNG=y # CONFIG_B43_DEBUG is not set …" name="twitter:description"/>
<title>WIFI-AP  · Just MEMO
</title>
<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet"/>
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet"/>
<link href="./theme/css/pygments.css" media="screen" rel="stylesheet" type="text/css"/>
<link href="./theme/tipuesearch/tipuesearch.css" media="screen" rel="stylesheet" type="text/css"/>
<link href="./theme/css/elegant.css" media="screen" rel="stylesheet" type="text/css"/>
<link href="./theme/css/custom.css" media="screen" rel="stylesheet" type="text/css"/>
</meta></meta></meta></meta></head>
<body>
<div id="content-sans-footer">
<div class="navbar navbar-static-top">
<div class="navbar-inner">
<div class="container-fluid">
<a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</a>
<a class="brand" href="./"><span class="site-name">Just MEMO</span></a>
<div class="nav-collapse collapse">
<ul class="nav pull-right top-menu">
<li><a href=".">Home</a></li>
<li><a href="./categories.html">Categories</a></li>
<li><a href="./tags.html">Tags</a></li>
<li><a href="./archives.html">Archives</a></li>
<li><form action="./search.html" class="navbar-search" onsubmit="return validateForm(this.elements['q'].value);"> <input class="search-query" id="tipue_search_input" name="q" placeholder="Search" type="text"/></form></li>
</ul>
</div>
</div>
</div>
</div>
<div class="container-fluid">
<div class="row-fluid">
<div class="span1"></div>
<div class="span10">
<article>
<div class="row-fluid">
<header class="page-header span10 offset2">
<h1><a href="./wifi-ap.html"> <span class="caps">WIFI</span>-<span class="caps">AP</span> </a></h1>
</header>
</div>
<div class="row-fluid">
<div class="span2 table-of-content">
<nav>
<h4>Contents</h4>
<div id="toc"><ul><li><a class="toc-href" href="#check hardware" title="Check hardware">Check hardware</a></li><li><a class="toc-href" href="#kernel config" title="Kernel config">Kernel config</a></li><li><a class="toc-href" href="#intall package" title="Intall package">Intall package</a></li><li><a class="toc-href" href="#by wpa_supplicant" title="By wpa_supplicant">By wpa_supplicant</a><ul><li><a class="toc-href" href="#dhcp server" title="DHCP server">DHCP server</a></li><li><a class="toc-href" href="#start wifi interface, controlled by wpa_supplicant and dhcp server:" title="Start wifi interface, controlled by wpa_supplicant and DHCP server:">Start wifi interface, controlled by wpa_supplicant and DHCP server:</a></li><li><a class="toc-href" href="#set for permanent /etc/conf.d/net" title="Set for permanent /etc/conf.d/net">Set for permanent /etc/conf.d/net</a></li><li><a class="toc-href" href="#add route" title="Add route">Add route</a></li></ul></li><li><a class="toc-href" href="#default services_1" title="Default services">Default services</a></li><li><a class="toc-href" href="#by hostapd" title="By hostapd">By hostapd</a></li><li><a class="toc-href" href="#default service" title="Default service">Default service</a></li></ul></div>
</nav>
</div>
<div class="span8 article-content">
<h3 id="check hardware">Check hardware</h3>
<div class="highlight"><pre><span></span>lspci -n <span class="p">|</span> grep 14e4
</pre></div>
<h3 id="kernel config">Kernel config</h3>
<div class="highlight"><pre><span></span><span class="nv">CONFIG_WLAN_VENDOR_BROADCOM</span><span class="o">=</span>y
<span class="nv">CONFIG_B43</span><span class="o">=</span>m
<span class="nv">CONFIG_B43_BCMA</span><span class="o">=</span>y
<span class="nv">CONFIG_B43_SSB</span><span class="o">=</span>y
<span class="nv">CONFIG_B43_BUSES_BCMA_AND_SSB</span><span class="o">=</span>y
<span class="c1"># CONFIG_B43_BUSES_BCMA is not set</span>
<span class="c1"># CONFIG_B43_BUSES_SSB is not set</span>
<span class="nv">CONFIG_B43_PCI_AUTOSELECT</span><span class="o">=</span>y
<span class="nv">CONFIG_B43_PCICORE_AUTOSELECT</span><span class="o">=</span>y
<span class="nv">CONFIG_B43_SDIO</span><span class="o">=</span>y
<span class="nv">CONFIG_B43_BCMA_PIO</span><span class="o">=</span>y
<span class="nv">CONFIG_B43_PIO</span><span class="o">=</span>y
<span class="nv">CONFIG_B43_PHY_G</span><span class="o">=</span>y
<span class="nv">CONFIG_B43_PHY_N</span><span class="o">=</span>y
<span class="nv">CONFIG_B43_PHY_LP</span><span class="o">=</span>y
<span class="nv">CONFIG_B43_PHY_HT</span><span class="o">=</span>y
<span class="nv">CONFIG_B43_HWRNG</span><span class="o">=</span>y
<span class="c1"># CONFIG_B43_DEBUG is not set</span>
<span class="nv">CONFIG_B43LEGACY</span><span class="o">=</span>m
<span class="nv">CONFIG_B43LEGACY_PCI_AUTOSELECT</span><span class="o">=</span>y
<span class="nv">CONFIG_B43LEGACY_PCICORE_AUTOSELECT</span><span class="o">=</span>y
<span class="nv">CONFIG_B43LEGACY_HWRNG</span><span class="o">=</span>y
<span class="nv">CONFIG_B43LEGACY_DEBUG</span><span class="o">=</span>y
<span class="nv">CONFIG_B43LEGACY_DMA</span><span class="o">=</span>y
<span class="nv">CONFIG_B43LEGACY_PIO</span><span class="o">=</span>y
<span class="nv">CONFIG_B43LEGACY_DMA_AND_PIO_MODE</span><span class="o">=</span>y
<span class="c1"># CONFIG_B43LEGACY_DMA_MODE is not set</span>
<span class="c1"># CONFIG_B43LEGACY_PIO_MODE is not set</span>
<span class="nv">CONFIG_BRCMUTIL</span><span class="o">=</span>m
<span class="nv">CONFIG_BRCMSMAC</span><span class="o">=</span>m
<span class="nv">CONFIG_BRCMFMAC</span><span class="o">=</span>m
<span class="nv">CONFIG_BRCMFMAC_PROTO_BCDC</span><span class="o">=</span>y
<span class="nv">CONFIG_BRCMFMAC_SDIO</span><span class="o">=</span>y
<span class="c1"># CONFIG_BRCMFMAC_USB is not set</span>
<span class="c1"># CONFIG_BRCMFMAC_PCIE is not set</span>
</pre></div>
<h3 id="intall package">Intall package</h3>
<div class="highlight"><pre><span></span>emerge -avq net-wireless/b43-fwcutter
emerge -avq sys-firmware/b43-firmware
</pre></div>
<h3 id="by wpa_supplicant">By wpa_supplicant</h3>
<p>Linux desktop connected to the Internet (wire, <span class="caps">LTE</span> modem) and it has a wifi card which is managed by wpa_supplicant, you can easily setup this computer as WiFi access point. You even don’t need hostapd - just wpa_supplicant and dhcp server software.</p>
<p>Configure wpa_supplicant.conf as follows (mode=2 is Access Point mode, for more see documentation):</p>
<ul>
<li>Find the hardware info</li>
</ul>
<div class="highlight"><pre><span></span>iw phy
</pre></div>
<ul>
<li>/etc/wpa_spplicant/wpa_supplicant.conf</li>
</ul>
<div class="highlight"><pre><span></span><span class="nv">network</span><span class="o">={</span>
    <span class="nv">ssid</span><span class="o">=</span><span class="s2">"AP-NAME"</span>
    <span class="nv">mode</span><span class="o">=</span><span class="m">2</span>
    <span class="nv">key_mgmt</span><span class="o">=</span>WPA-PSK
    <span class="nv">psk</span><span class="o">=</span><span class="s2">"password"</span>
    <span class="nv">frequency</span><span class="o">=</span><span class="m">2462</span>
<span class="o">}</span>
</pre></div>
<p>You can choose right frequncy according to the table on wikipedia.</p>
<h4 id="dhcp server"><span class="caps">DHCP</span> server</h4>
<ul>
<li>install dhcp with server use </li>
</ul>
<div class="highlight"><pre><span></span>su
<span class="nb">echo</span> ‘net-misc/dhcp server’ <span class="p">|</span> sudo tee -a /etc/portage/package.use
emerge -avq net-misc/dhcp
</pre></div>
<ul>
<li>/etc/conf.d/dhpcd</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># /etc/conf.d/dhcpd: config file for /etc/init.d/dhcpd</span>

<span class="c1"># If you require more than one instance of dhcpd you can create symbolic</span>
<span class="c1"># links to dhcpd service like so</span>
<span class="c1">#   cd /etc/init.d</span>
<span class="c1">#   ln -s dhcpd dhcpd.foo</span>
<span class="c1">#   cd ../conf.d</span>
<span class="c1">#   cp dhcpd dhcpd.foo</span>
<span class="c1"># Now you can edit dhcpd.foo and specify a different configuration file.</span>
<span class="c1"># You'll also need to specify a pidfile in that dhcpd.conf file.</span>
<span class="c1"># See the pid-file-name option in the dhcpd.conf man page for details.</span>

<span class="c1"># If you wish to run dhcpd in a chroot, uncomment the following line</span>
<span class="c1"># DHCPD_CHROOT="/var/lib/dhcp/chroot"</span>

<span class="c1"># All file paths below are relative to the chroot.</span>
<span class="c1"># You can specify a different chroot directory but MAKE SURE it's empty.</span>

<span class="c1"># Specify a configuration file - the default is /etc/dhcp/dhcpd.conf</span>
<span class="nv">DHCPD_CONF</span><span class="o">=</span><span class="s2">"/etc/dhcp/dhcpd.conf"</span>

<span class="c1"># Configure which interface or interfaces to for dhcpd to listen on.</span>
<span class="c1"># List all interfaces space separated. If this is not specified then</span>
<span class="c1"># we listen on all interfaces.</span>
<span class="nv">DHCPD_IFACE</span><span class="o">=</span><span class="s2">"wlan0"</span>

<span class="c1"># Insert any other dhcpd options - see the man page for a full list.</span>
<span class="c1"># DHCPD_OPTS=""</span>
</pre></div>
<ul>
<li>Configure /etc/dhcp/dhcpd.conf</li>
</ul>
<p><strong>特别说明</strong>，因为加入本地DNS服务器，所有要在本地DNS服务器的name.conf中，把192.168.6.0/24加入acl “trusted”. 负责无法解析。</p>
<div class="highlight"><pre><span></span>subnet <span class="m">192</span>.168.6.0 netmask <span class="m">255</span>.255.255.0 <span class="o">{</span>
  interface wlan0<span class="p">;</span>
  range <span class="m">192</span>.168.6.20 <span class="m">192</span>.168.6.30<span class="p">;</span>
  option domain-name-servers <span class="m">192</span>.168.0.199, <span class="m">192</span>.168.0.1<span class="p">;</span>
  option domain-search <span class="s2">"ghome"</span><span class="p">;</span>
  option routers <span class="m">192</span>.168.6.1<span class="p">;</span>
  option broadcast-address <span class="m">192</span>.168.6.255<span class="p">;</span>
  default-lease-time <span class="m">600</span><span class="p">;</span>
  max-lease-time <span class="m">7200</span><span class="p">;</span>
<span class="o">}</span>
</pre></div>
<h4 id="start wifi interface, controlled by wpa_supplicant and dhcp server:">Start wifi interface, controlled by wpa_supplicant and <span class="caps">DHCP</span> server:</h4>
<div class="highlight"><pre><span></span>sudo /etc/init.d/net.wifi start
sudo ifconfig wifi <span class="m">192</span>.168.6.1/24
</pre></div>
<h4 id="set for permanent /etc/conf.d/net">Set for permanent /etc/conf.d/net</h4>
<div class="highlight"><pre><span></span><span class="c1">### WIRED to internet ###</span>
<span class="nv">config_eth0</span><span class="o">=</span><span class="s2">"192.168.0.199 netmask 255.255.255.0 brd 192.168.0.255"</span>
<span class="nv">routes_eth0</span><span class="o">=</span><span class="s2">"default via 192.168.0.1"</span>

<span class="c1">### WIFI ###</span>
<span class="nv">modules_wlan0</span><span class="o">=</span><span class="s2">"wpa_supplicant"</span>
<span class="nv">config_wlan0</span><span class="o">=</span><span class="s2">"192.168.6.1/24"</span>
<span class="nv">wpa_supplicant_wlan0</span><span class="o">=</span><span class="s2">"-Dnl80211 -d -f /var/log/wpa_supplicant.log"</span>
</pre></div>
<h4 id="add route">Add route</h4>
<p>假设192.168.0.199 wired to the Internet</p>
<div class="highlight"><pre><span></span>sudo <span class="nb">echo</span> <span class="m">1</span> &gt; /proc/sys/net/ipv4/ip_forward
sudo iptables -t nat -A POSTROUTING --source <span class="m">192</span>.168.6.0/24 -j SNAT --to <span class="m">192</span>.168.0.199
sudo /etc/init.d/iptables save
sudo rc-update add iptables default
</pre></div>
<p>/etc/sysctl.conf:</p>
<div class="highlight"><pre><span></span>net.ipv4.ip_forward <span class="o">=</span> <span class="m">1</span>
</pre></div>
<h3 id="default services_1">Default services</h3>
<div class="highlight"><pre><span></span>rc-update add wpa_supplicant default
rc-update add net.wlan0 default
</pre></div>
<h3 id="by hostapd">By hostapd</h3>
<ul>
<li>/etc/conf.d/net</li>
</ul>
<div class="highlight"><pre><span></span>Disable wpa_supplicant first

<span class="c1">### WIRED ###</span>
<span class="nv">config_eth0</span><span class="o">=</span><span class="s2">"192.168.0.199 netmask 255.255.255.0 brd 192.168.0.255"</span>
<span class="nv">routes_eth0</span><span class="o">=</span><span class="s2">"default via 192.168.0.1"</span>

<span class="nv">modules_wlan0</span><span class="o">=</span><span class="s2">"!wpa_supplicant"</span>
<span class="c1">#wpa_supplicant_wlan0="-Dnl80211 -d -f /var/log/wpa_supplicant.log"</span>
<span class="nv">config_wlan0</span><span class="o">=</span><span class="s2">"192.168.6.1/24"</span>
<span class="nv">routes_wlan0</span><span class="o">=</span><span class="s2">"default via 192.168.0.1"</span>
</pre></div>
<ul>
<li>/etc/hostapd/hostapd.conf</li>
</ul>
<div class="highlight"><pre><span></span><span class="nv">interface</span><span class="o">=</span>wlan0
<span class="nv">driver</span><span class="o">=</span>nl80211
<span class="nv">logger_syslog</span><span class="o">=</span>-1
<span class="nv">logger_syslog_level</span><span class="o">=</span><span class="m">2</span>
<span class="nv">logger_stdout</span><span class="o">=</span>-1
<span class="nv">logger_stdout_level</span><span class="o">=</span><span class="m">2</span>
<span class="nv">ctrl_interface</span><span class="o">=</span>/var/run/hostapd
<span class="nv">ctrl_interface_group</span><span class="o">=</span><span class="m">0</span>
<span class="nv">ssid</span><span class="o">=</span><span class="nb">test</span>
<span class="nv">hw_mode</span><span class="o">=</span>g
<span class="nv">channel</span><span class="o">=</span><span class="m">1</span>
<span class="nv">beacon_int</span><span class="o">=</span><span class="m">100</span>
<span class="nv">dtim_period</span><span class="o">=</span><span class="m">2</span>
<span class="nv">max_num_sta</span><span class="o">=</span><span class="m">255</span>
<span class="nv">rts_threshold</span><span class="o">=</span>-1
<span class="nv">fragm_threshold</span><span class="o">=</span>-1
<span class="nv">macaddr_acl</span><span class="o">=</span><span class="m">0</span>
<span class="nv">auth_algs</span><span class="o">=</span><span class="m">1</span>
<span class="nv">ignore_broadcast_ssid</span><span class="o">=</span><span class="m">0</span>
<span class="nv">wmm_enabled</span><span class="o">=</span><span class="m">1</span>
<span class="nv">wmm_ac_bk_cwmin</span><span class="o">=</span><span class="m">4</span>
<span class="nv">wmm_ac_bk_cwmax</span><span class="o">=</span><span class="m">10</span>
<span class="nv">wmm_ac_bk_aifs</span><span class="o">=</span><span class="m">7</span>
<span class="nv">wmm_ac_bk_txop_limit</span><span class="o">=</span><span class="m">0</span>
<span class="nv">wmm_ac_bk_acm</span><span class="o">=</span><span class="m">0</span>
<span class="nv">wmm_ac_be_aifs</span><span class="o">=</span><span class="m">3</span>
<span class="nv">wmm_ac_be_cwmin</span><span class="o">=</span><span class="m">4</span>
<span class="nv">wmm_ac_be_cwmax</span><span class="o">=</span><span class="m">10</span>
<span class="nv">wmm_ac_be_txop_limit</span><span class="o">=</span><span class="m">0</span>
<span class="nv">wmm_ac_be_acm</span><span class="o">=</span><span class="m">0</span>
<span class="nv">wmm_ac_vi_aifs</span><span class="o">=</span><span class="m">2</span>
<span class="nv">wmm_ac_vi_cwmin</span><span class="o">=</span><span class="m">3</span>
<span class="nv">wmm_ac_vi_cwmax</span><span class="o">=</span><span class="m">4</span>
<span class="nv">wmm_ac_vi_txop_limit</span><span class="o">=</span><span class="m">94</span>
<span class="nv">wmm_ac_vi_acm</span><span class="o">=</span><span class="m">0</span>
<span class="nv">wmm_ac_vo_aifs</span><span class="o">=</span><span class="m">2</span>
<span class="nv">wmm_ac_vo_cwmin</span><span class="o">=</span><span class="m">2</span>
<span class="nv">wmm_ac_vo_cwmax</span><span class="o">=</span><span class="m">3</span>
<span class="nv">wmm_ac_vo_txop_limit</span><span class="o">=</span><span class="m">47</span>
<span class="nv">wmm_ac_vo_acm</span><span class="o">=</span><span class="m">0</span>
<span class="nv">ht_capab</span><span class="o">=[</span>SHORT-GI-40<span class="o">]</span>
<span class="nv">eapol_key_index_workaround</span><span class="o">=</span><span class="m">0</span>
<span class="nv">eap_server</span><span class="o">=</span><span class="m">0</span>
<span class="nv">own_ip_addr</span><span class="o">=</span><span class="m">127</span>.0.0.1
<span class="nv">wpa</span><span class="o">=</span><span class="m">2</span>
<span class="nv">wpa_passphrase</span><span class="o">=</span>Helecomm1
<span class="nv">wpa_key_mgmt</span><span class="o">=</span>WPA-PSK
<span class="nv">rsn_pairwise</span><span class="o">=</span>CCMP
<span class="nv">ssid</span><span class="o">=</span>ghome2
</pre></div>
<h3 id="default service">Default service</h3>
<div class="highlight"><pre><span></span>rc-update add hostapd default
rc-update add dhcpd default
rc-update add net.wlan0 default
</pre></div>
<hr/>
</div>
<section>
<div class="span2" style="float:right;font-size:0.9em;">
<h4>Published</h4>
<time datetime="2017-11-16T16:55:00+08:00" pubdate="pubdate">Nov 16, 2017</time>
<h4>Last Updated</h4>
<time datetime="2018-03-15T10:43:53+08:00">Mar 15, 2018</time>
<h4>Category</h4>
<a class="category-link" href="./categories.html#tech-ref">Tech</a>
<h4>Tags</h4>
<ul class="list-of-tags tags-in-article">
<li><a href="./tags.html#gentoo-wifi-ref">Gentoo wifi
                    <span>1</span>
</a></li>
</ul>
<h4>Contact</h4>
<a class="sidebar-social-links" href="https://slashdot.org/" target="_blank" title="My IT新闻Slashdot Profile">
<i class="fa fa-it新闻slashdot sidebar-social-links"></i></a>
</div>
</section>
</div>
</article>
</div>
<div class="span1"></div>
</div>
</div>
<div id="push"></div>
</div>
<footer>
<div id="footer">
<ul class="footer-content">
<li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="https://github.com/Pelican-Elegant/elegant/" title="Theme Elegant Home Page">Elegant</a></li>
</ul>
</div>
</footer> <script src="http://code.jquery.com/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>
</body>
<!-- Theme: Elegant built for Pelican
    License : MIT -->
</html>