<!DOCTYPE html>

<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
<title>Tor - Just MEMO</title>
<!-- Using the latest rendering mode for IE -->
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="./tor.html" rel="canonical"/>
<meta content="Walter" name="author">
<meta content="Install tor sudo emerge -avq tor Intall meek git clone https://git.torproject.org/pluggable-transports/meek.git 这里需要了解的一点是meek-client是基于Tor的一个库写的，在代码中也可以看到工程的头部引用了Tor的一个go库。 因此直接进入目录里编译的话会报错。 解决方案是让go拉取Tor的对应库： cd meek go get git.torproject.org/pluggable-transports/goptlib.git 编译meek-client cd meek-cilent go build sudo cp meek-client /usr/bin/ Config FILE: /etc/tor/torrc User tor PIDFile /var …" name="description">
<meta content="Just MEMO" property="og:site_name">
<meta content="article" property="og:type"/>
<meta content="Tor" property="og:title"/>
<meta content="./tor.html" property="og:url"/>
<meta content="Install tor sudo emerge -avq tor Intall meek git clone https://git.torproject.org/pluggable-transports/meek.git 这里需要了解的一点是meek-client是基于Tor的一个库写的，在代码中也可以看到工程的头部引用了Tor的一个go库。 因此直接进入目录里编译的话会报错。 解决方案是让go拉取Tor的对应库： cd meek go get git.torproject.org/pluggable-transports/goptlib.git 编译meek-client cd meek-cilent go build sudo cp meek-client /usr/bin/ Config FILE: /etc/tor/torrc User tor PIDFile /var …" property="og:description"/>
<meta content="2018-04-13" property="article:published_time"/>
<meta content="Tech" property="article:section"/>
<meta content="Walter" property="article:author"/>
<!-- Bootstrap -->
<link href="./theme/css/bootstrap.paper.min.css" rel="stylesheet" type="text/css">
<link href="./theme/css/font-awesome.min.css" rel="stylesheet"/>
<link href="./theme/css/pygments/default.css" rel="stylesheet"/>
<link href="./theme/tipuesearch/tipuesearch.css" rel="stylesheet"/>
<link href="./theme/css/html4css1.css" rel="stylesheet"/>
<link href="./theme/css/typogrify.css" rel="stylesheet"/>
<link href="./theme/css/style.css" rel="stylesheet" type="text/css">
<link href="./static/custom.css" rel="stylesheet"/>
<link href="./theme/css/shariff/shariff.min.css" rel="stylesheet"/>
</link></link></meta></meta></meta></head>
<body>
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container">
<div class="navbar-header">
<button class="navbar-toggle" data-target=".navbar-ex1-collapse" data-toggle="collapse" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="./">
Just MEMO            </a>
</div>
<div class="collapse navbar-collapse navbar-ex1-collapse">
<ul class="nav navbar-nav">
<li><a href="/">Home</a></li>
<li><a href="/archives.html">Archives</a></li>
<li><a href="/search.html">Search</a></li>
<li>
<a href="./category/chan-lun.html">缠论</a>
</li>
<li>
<a href="./category/eco.html">Eco</a>
</li>
<li>
<a href="./category/futstock.html">Fut&amp;stock</a>
</li>
<li>
<a href="./category/life.html">Life</a>
</li>
<li>
<a href="./category/shu-fa.html">书法</a>
</li>
<li class="active">
<a href="./category/tech.html">Tech</a>
</li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li><span>
<form action="/search.html" class="navbar-search">
<input class="search-query" id="tipue_search_input" name="q" placeholder="Search" required="" type="text"/>
</form></span>
</li>
<li><a href="./archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
</ul>
</div>
<!-- /.navbar-collapse -->
</div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
<div class="row">
<div class="col-sm-9">
<section id="content">
<article>
<header class="page-header">
<h1>
<a href="./tor.html" rel="bookmark" title="Permalink to Tor">
                        Tor
                    </a>
</h1>
</header>
<div class="entry-content">
<div class="panel">
<div class="panel-body">
<footer class="post-info">
<span class="label label-default">Date</span>
<span class="published">
<i class="fa fa-calendar"></i><time datetime="2018-04-13T10:36:08+08:00"> 2018-04-13 10:36:08+08:00</time>
</span>
</footer><!-- /.post-info --> <span class="label label-default">Modified</span>
<span class="published">
<i class="fa fa-calendar"></i><time datetime="2018-04-13T10:36:08+08:00">2018-04-13 10:36:08+08:00</time>
</span>
</div></div></div></article></section></div></div></div></body></html>


<!-- Added by Walter for pelican-toc within a article -->
<div id="toc"><ul><li><a class="toc-href" href="#" title="Tor">Tor</a><ul><li><a class="toc-href" href="#install tor" title="Install tor">Install tor</a><ul><li><a class="toc-href" href="#intall meek" title="Intall meek">Intall meek</a></li></ul></li><li><a class="toc-href" href="#config_1" title="Config">Config</a></li><li><a class="toc-href" href="#generate tor hash password" title="Generate tor hash password">Generate tor hash password</a><ul><li><a class="toc-href" href="#nyx monitor" title="Nyx monitor">Nyx monitor</a></li></ul></li><li><a class="toc-href" href="#coding for reset tor_1" title="Coding for reset tor">Coding for reset tor</a><ul><li><a class="toc-href" href="#python" title="python">python</a></li></ul></li><li><a class="toc-href" href="#explain of meek config in torrc_1" title="Explain of meek config in torrc">Explain of meek config in torrc</a><ul><li><a class="toc-href" href="#meek yuan li" title="Meek 原理">Meek 原理</a></li><li><a class="toc-href" href="#guan yu pei zhi wen jian" title="关于配置文件">关于配置文件</a></li><li><a class="toc-href" href="#zhao dao zui xin de meek-server" title="找到最新的meek-server">找到最新的meek-server</a></li><li><a class="toc-href" href='#zhao dao "front="de yu ming' title="找到“front=”的域名">找到“front=”的域名</a></li><li><a class="toc-href" href="#ru he cha zhao yu ming de zi yu ming" title="如何查找域名的子域名">如何查找域名的子域名</a></li></ul></li><li><a class="toc-href" href="#pei zhi http proxy_1" title="配置http proxy">配置http proxy</a><ul><li><a class="toc-href" href="#install" title="Install">Install</a></li><li><a class="toc-href" href="#config_2" title="Config">Config</a></li></ul></li></ul></li></ul></div>
<h2 id="install tor">Install tor</h2>
<div class="highlight"><pre><span></span>sudo emerge -avq tor
</pre></div>
<h3 id="intall meek"><a href="http://allinfa.com/linux-tor-meek.html">Intall meek</a></h3>
<div class="highlight"><pre><span></span>git clone https://git.torproject.org/pluggable-transports/meek.git
</pre></div>
<p>这里需要了解的一点是meek-client是基于Tor的一个库写的，在代码中也可以看到工程的头部引用了Tor的一个go库。 因此直接进入目录里编译的话会报错。 解决方案是让go拉取Tor的对应库：</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> meek
go get git.torproject.org/pluggable-transports/goptlib.git
</pre></div>
<p>编译meek-client</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> meek-cilent
go build
sudo cp meek-client /usr/bin/
</pre></div>
<h2 id="config_1">Config</h2>
<div class="file"><span style="margin-right: .5em; margin-left:0.3em; font-size:80%; font-weight:bold">FILE:</span> /etc/tor/torrc</div>
<div class="highlight"><pre><span></span>User tor
PIDFile /var/run/tor/tor.pid
DataDirectory   /var/lib/tor/data
Log warn syslog

<span class="c1">###### Socket Proxy Port ######</span>
SOCKSPort <span class="m">192</span>.168.0.199:9050
SOCKSPolicy accept <span class="m">192</span>.168.0.0/24

<span class="c1">###### Http Proxy Port #####</span>
HTTPTunnelPort <span class="m">192</span>.168.0.199:9060 OnionTrafficOnly


<span class="c1">###### Nyx Monitor #######</span>
ControlPort <span class="m">9051</span>
HashedControlPassword <span class="m">16</span>:64D63491C3E1077E609BA395D0C68765D60044EDF9DRB5BE909284DAA9

<span class="c1">##### DarkNet Server #####</span>
HiddenServiceDir /var/lib/tor/hidden_service/
HiddenServicePort <span class="m">4444</span> <span class="m">127</span>.0.0.1:8000

<span class="c1">###### Meek #######</span>
UseBridges <span class="m">1</span>
ClientTransportPlugin meek <span class="nb">exec</span>  /usr/bin/meek-client
Bridge meek <span class="m">0</span>.0.2.0:1 <span class="nv">url</span><span class="o">=</span>https://meek.azureedge.net/ <span class="nv">front</span><span class="o">=</span>ajax.aspnetcdn.com
Bridge meek <span class="m">0</span>.0.2.0:2 <span class="nv">url</span><span class="o">=</span>https://d2cly7j4zqgua7.cloudfront.net/ <span class="nv">front</span><span class="o">=</span>a0.awsstatic.com
</pre></div>
<h2 id="generate tor hash password">Generate tor hash password</h2>
<p>copy the following result to file /etc/tor/torrc</p>
<div class="highlight"><pre><span></span>tor --hash-password mypassword
</pre></div>
<h3 id="nyx monitor">Nyx monitor</h3>
<div class="highlight"><pre><span></span>sudo emerge -avq nyx
</pre></div>
<h2 id="coding for reset tor_1">Coding for reset tor</h2>
<h3 id="python">python</h3>
<div class="highlight"><pre><span></span>from stem import Signal
from stem.control import Controller
with Controller.from_port<span class="o">(</span><span class="nv">port</span> <span class="o">=</span> <span class="m">9051</span><span class="o">)</span> as controller:
  controller.authenticate<span class="o">(</span><span class="s1">'password ofr 9051'</span><span class="o">)</span>
    controller.signal<span class="o">(</span>Signal.NEWNYM<span class="o">)</span>
</pre></div>
<h2 id="explain of meek config in torrc_1">Explain of meek config in torrc</h2>
<h3 id="meek yuan li">Meek 原理</h3>
<p>简单来说MEEK插件的原理就是客户端先与云平台（<span class="caps">GAE</span>，amazon，Azure）连接，看上去是访问云平台（front domain），实际上是以云平台作为中介访问MEEK server再连接Tor中继形成Tor电路的。这些云平台很多公司都要使用，所以审查者不敢随意封杀。</p>
<p>但如果审查者还就是什么都不管，把云平台给屏蔽了呢？比如说天朝GFW就直接把GAE给完全屏蔽了，直接使得MEEK-google失效。我也看到有些人反映其他两个MEEK插件在有些地方也连不上了，这时候又应该怎么做呢？</p>
<p>屏蔽云平台最常用的方法就是DNS污染了，这时可以试着把本地连接的DNS服务器设置为国外的DNS服务器。</p>
<h3 id="guan yu pei zhi wen jian">关于配置文件</h3>
<div class="file"><span style="margin-right: .5em; margin-left:0.3em; font-size:80%; font-weight:bold">FILE:</span> /etc/tor/torrc</div>
<div class="highlight"><pre><span></span>meek 0.0.2.0:1 url=https://meek-reflect.appspot.com/ front=www.google.com
meek 0.0.2.0:2 url=https://d2zfqthxsdq309.cloudfront.net/ front=a0.awsstatic.com
meek 0.0.2.0:3 url=https://az668014.vo.msecnd.net/ front=ajax.aspnetcdn.com
</pre></div>
<ol>
<li>meek表示传输名，不能省略也不能改动；后面的0.0.2.0:1可以修改为任何值（除了0.0.0.x之外，因为这是Tor内部默认使用的地址）；</li>
<li>“url=https://az668014.vo.msecnd.net/ ”是MEEK server的域名，GFW封锁它也没有意义；</li>
<li><strong>front=ajax.aspnetcdn.com</strong>是云平台的域名（front domain），一旦被GFW封锁，MEEK插件就会失效。</li>
</ol>
<h3 id="zhao dao zui xin de meek-server">找到最新的meek-server</h3>
<p>Mac <span class="caps">OS</span> 中先安装tor-browser</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> /Applications/TorBrowser.app
grep -ri <span class="m">0</span>.0.2.0 *
</pre></div>
<p>可以找到有关部分 <span style="color:red;">Contents/Resources/distribution/preferences/extension-overrides.js</span>:pref(“extensions.torlauncher.default_bridge.meek-amazon.1”, “<span style="color:red;">meek 0.0.2.0:2 <span class="caps">B9E7141C594AF25699E0079C1F0146F409495296</span> url=https://d2cly7j4zqgua7.cloudfront.net/ front=a0.awsstatic.com</span>“);</p>
<h3 id='zhao dao "front="de yu ming'>找到“front=”的域名</h3>
<p>让MEEK插件复活的关键就在于要把默认的front domain修改成未被屏蔽的域名。例如在google被屏蔽了，但有一些google服务并没有被屏蔽，例如被各大网站广泛使用的Google Analytics和DoubleClick ads，可以试着把front domain换成对应的front=ssl.google-analytics.com或front=www.doubleclick.net，或者还可以寻找其他的google服务的域名。还有就是hosts修改可用的google <span class="caps">IP</span>，或者像goagent一样上传。</p>
<p><span class="caps">MEEK</span>-amazon也是类似的修改方法，<a href="http://www.alexa.com/siteinfo/cloudfront.net">http://www.alexa.com/siteinfo/cloudfront.net</a> 这里有一堆可用的域名</p>
<p><span class="caps">MEEK</span>-azure也一样，可以搜索一些属于Azure CDN的子域名，例如front=officeimg.vo.msecnd.net</p>
<h3 id="ru he cha zhao yu ming de zi yu ming">如何查找域名的子域名</h3>
<p>最简单的方法，比如google中用搜索 <code>site: fool.com</code>，就可以搜索到fool.com大部分的子域名。</p>
<h2 id="pei zhi http proxy_1">配置http proxy</h2>
<h3 id="install">Install</h3>
<div class="highlight"><pre><span></span>emerge -avq net-proxy/privoxy
</pre></div>
<h3 id="config_2">Config</h3>
<div class="file"><span style="margin-right: .5em; margin-left:0.3em; font-size:80%; font-weight:bold">FILE:</span> /etc/privoxy/config</div>
<div class="highlight"><pre><span></span>listen-address  <span class="m">192</span>.168.0.199:9051
forward-socks5t   /               <span class="m">192</span>.168.0.199:9050 .
</pre></div>

<!-- /.entry-content -->
<hr/>
<!-- Shariff Button BEGIN -->
<div class="shariff" data-orientation="" data-url="./tor.html"></div>
<!-- Shariff Button END -->



<div class="col-sm-3" id="sidebar">
<aside>
<section class="well well-sm">
<ul class="list-group list-group-flush">
<li class="list-group-item"><a href="./"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
<ul class="list-group list-inline tagcloud" id="tags">
<li class="list-group-item tag-2">
<a href="./tag/apache.html">
                            apache
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/automator.html">
                            automator
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/bai-du-wang-pan.html">
                            百度网盘
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/bitcoin-blockchain.html">
                            bitcoin blockchain
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/cao-zuo.html">
                            操作
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/chan-lun.html">
                            缠论
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/chan-lun-108ke.html">
                            缠论108课
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/chan-lun-stock.html">
                            缠论stock
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/dns.html">
                            dns
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/english.html">
                            english
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/future.html">
                            future
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/gentoo.html">
                            Gentoo
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/gentoo-wifi.html">
                            Gentoo wifi
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/git.html">
                            git
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/hexo.html">
                            hexo
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/image.html">
                            image
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/iphone.html">
                            iphone
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/iptables.html">
                            iptables
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/life.html">
                            life
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/linux.html">
                            linux
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/linux-print.html">
                            linux print
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/mac.html">
                            mac
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/matplotlib.html">
                            matplotlib
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/mongodb.html">
                            mongodb
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/movies.html">
                            Movies
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/mysql.html">
                            mysql
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/network.html">
                            network
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/nginx.html">
                            nginx
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/pandas.html">
                            pandas
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/perl.html">
                            perl
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/python.html">
                            python
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/qi-huo.html">
                            期货
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/quanta.html">
                            quanta
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/shell.html">
                            shell
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/shu-fa.html">
                            书法
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/stock.html">
                            stock
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/tech.html">
                            tech
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/tech-php-nginx.html">
                            tech php nginx
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/tong-da-xin.html">
                            通达信
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/trading_digest.html">
                            trading_digest
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/vim.html">
                            vim
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/virtualbox.html">
                            virtualbox
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/webserver.html">
                            webserver
                        </a>
</li>
<li class="list-group-item tag-1">
<a href="./tag/windows.html">
                            windows
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/xiao-lu.html">
                            效率
                        </a>
</li>
<li class="list-group-item tag-2">
<a href="./tag/xiu-xin.html">
                            修心
                        </a>
</li>
</ul>
</li>
<li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
<ul class="list-group" id="social">
<li class="list-group-item"><a href="https://slashdot.org/"><i class="fa fa-it新闻slashdot-square fa-lg"></i> IT新闻Slashdot</a></li>
</ul>
</li>
<li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
<ul class="list-group" id="links">
<li class="list-group-item">
<a href="https://uqer.io/home/" target="_blank">
                量化平台：优矿
            </a>
</li>
<li class="list-group-item">
<a href="https://www.joinquant.com/" target="_blank">
                量化平台：聚宽
            </a>
</li>
<li class="list-group-item">
<a href="https://slashdot.org/" target="_blank">
                IT新闻Slashdot
            </a>
</li>
<li class="list-group-item">
<a href="http://www.solidot.org/" target="_blank">
                IT新闻Solidot
            </a>
</li>
<li class="list-group-item">
<a href="https://zhuanlan.zhihu.com/p/25608762" target="_blank">
                Python资源全汇总
            </a>
</li>
</ul>
</li>
</ul>
</section>
</aside>
</div>


<footer>
<div class="container">
<hr/>
<div class="row">
<div class="col-xs-10">© 2018 Walter
            · Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a> </div>
<div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
</div>
</div>
</footer>
<script src="./theme/js/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="./theme/js/bootstrap.min.js"></script>
<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="./theme/js/respond.min.js"></script>
<!-- add shariff support -->
<script src="./theme/js/shariff.min.js"></script>
<script src="./theme/js/jquery.bootstrap-autohidingnavbar.min.js"></script>
<script>$("div.navbar-fixed-top").autoHidingNavbar();</script>
<script>
	$(document).ready(function () {
  		$("div.navbar-fixed-top").autoHidingNavbar('setDisableAutohide', false );
	});
</script>

