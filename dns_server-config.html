<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Walter" />
        <meta name="copyright" content="Walter" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="tech, dns, Tech, " />

<meta property="og:title" content="DNS_Server Config "/>
<meta property="og:url" content="./dns_server-config.html" />
<meta property="og:description" content="Install emerge -aqv bind bind-tools Config /* * Refer to the named.conf(5) and named(8) man pages, and the documentation * in /usr/share/doc/bind-* for more details. * Online versions of the documentation can be found here: * https://kb.isc.org/article/AA-01031 * * If you are going to set up …" />
<meta property="og:site_name" content="Just MEMO" />
<meta property="og:article:author" content="Walter" />
<meta property="og:article:published_time" content="2018-03-09T18:30:08+08:00" />
<meta property="og:article:modified_time" content="2018-03-09T18:30:08+08:00" />
<meta name="twitter:title" content="DNS_Server Config ">
<meta name="twitter:description" content="Install emerge -aqv bind bind-tools Config /* * Refer to the named.conf(5) and named(8) man pages, and the documentation * in /usr/share/doc/bind-* for more details. * Online versions of the documentation can be found here: * https://kb.isc.org/article/AA-01031 * * If you are going to set up …">

        <title>DNS_Server Config  · Just MEMO
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="./theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/custom.css" media="screen">


    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="./"><span class=site-name>Just MEMO</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href=".">Home</a></li>
                            <li ><a href="./categories.html">Categories</a></li>
                            <li ><a href="./tags.html">Tags</a></li>
                            <li ><a href="./archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="./search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="./dns_server-config.html"> DNS_Server&nbsp;Config  </a></h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div id="toc"><ul><li><a class="toc-href" href="#install" title="Install">Install</a></li><li><a class="toc-href" href="#config" title="Config">Config</a></li><li><a class="toc-href" href="#iptables rules" title="IPTABLES RULES">IPTABLES RULES</a></li><li><a class="toc-href" href="#te bie shuo ming" title="特别说明">特别说明</a></li></ul></div>
        </nav>
    </div>
    <div class="span8 article-content">

            
            <h3 id="install">Install</h3>
<div class="highlight"><pre><span></span>emerge -aqv <span class="nb">bind</span> bind-tools
</pre></div>
<h3 id="config">Config</h3>
<div class="highlight"><pre><span></span>/*
 * Refer to the named.conf<span class="o">(</span><span class="m">5</span><span class="o">)</span> and named<span class="o">(</span><span class="m">8</span><span class="o">)</span> man pages, and the documentation
 * in /usr/share/doc/bind-* <span class="k">for</span> more details.
 * Online versions of the documentation can be found here:
 * https://kb.isc.org/article/AA-01031
 *
 * If you are going to <span class="nb">set</span> up an authoritative server, make sure you
 * understand the hairy details of how DNS works. Even with simple mistakes,
 * you can <span class="nb">break</span> connectivity <span class="k">for</span> affected parties, or cause huge amounts of
 * useless Internet traffic.
 */

acl <span class="s2">"xfer"</span> <span class="o">{</span>
    /* Deny transfers by default except <span class="k">for</span> the listed hosts.
     * If we have other name servers, place them here.
     */
    none<span class="p">;</span>
<span class="o">}</span><span class="p">;</span>

/*
 * You might put in here some ips which are allowed to use the cache or
 * recursive queries
 */
acl <span class="s2">"trusted"</span> <span class="o">{</span>
    <span class="m">127</span>.0.0.0/8<span class="p">;</span>
    ::1/128<span class="p">;</span>
    <span class="m">192</span>.168.6.0/24<span class="p">;</span>
    <span class="m">192</span>.168.0.0/24<span class="p">;</span>
<span class="o">}</span><span class="p">;</span>

options <span class="o">{</span>
    directory <span class="s2">"/var/bind"</span><span class="p">;</span>
    pid-file <span class="s2">"/run/named/named.pid"</span><span class="p">;</span>

    /* https://www.isc.org/solutions/dlv &gt;<span class="o">=</span>bind-9.7.x only */
    //bindkeys-file <span class="s2">"/etc/bind/bind.keys"</span><span class="p">;</span>

    listen-on-v6 port <span class="m">53</span> <span class="o">{</span> ::1<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
    listen-on port <span class="m">53</span> <span class="o">{</span> <span class="m">127</span>.0.0.1<span class="p">;</span> <span class="m">192</span>.168.0.199<span class="p">;</span> <span class="o">}</span><span class="p">;</span>

    allow-query <span class="o">{</span>
        /*
         * Accept queries from our <span class="s2">"trusted"</span> ACL.  We will
         * allow anyone to query our master zones below.
         * This prevents us from becoming a free DNS server
         * to the masses.
         */
        trusted<span class="p">;</span>
    <span class="o">}</span><span class="p">;</span>

    allow-query-cache <span class="o">{</span>
        /* Use the cache <span class="k">for</span> the <span class="s2">"trusted"</span> ACL. */
        trusted<span class="p">;</span>
    <span class="o">}</span><span class="p">;</span>

    allow-recursion <span class="o">{</span>
        /* Only trusted addresses are allowed to use recursion. */
        trusted<span class="p">;</span>
    <span class="o">}</span><span class="p">;</span>

    allow-transfer <span class="o">{</span>
        /* Zone tranfers are denied by default. */
        none<span class="p">;</span>
    <span class="o">}</span><span class="p">;</span>

    allow-update <span class="o">{</span>
        /* Don<span class="s1">'t allow updates, e.g. via nsupdate. */</span>
<span class="s1">        none;</span>
<span class="s1">    };</span>

<span class="s1">    /*</span>
<span class="s1">    * If you'</span>ve got a DNS server around at your upstream provider, enter its
    * IP address here, and <span class="nb">enable</span> the line below. This will make you benefit
    * from its cache, thus reduce overall DNS traffic in the Internet.
    *
    * Uncomment the following lines to turn on DNS forwarding, and change
    *  and/or update the forwarding ip address<span class="o">(</span>es<span class="o">)</span>:
    */
    forward first<span class="p">;</span>
    forwarders <span class="o">{</span>
    //  <span class="m">123</span>.123.123.123<span class="p">;</span>    // Your ISP NS
    //  <span class="m">124</span>.124.124.124<span class="p">;</span>    // Your ISP NS
    //  <span class="m">4</span>.2.2.1<span class="p">;</span>        // Level3 Public DNS
    //  <span class="m">4</span>.2.2.2<span class="p">;</span>        // Level3 Public DNS
        <span class="m">8</span>.8.8.8<span class="p">;</span>        // Google Open DNS
        <span class="m">8</span>.8.4.4<span class="p">;</span>        // Google Open DNS
    <span class="o">}</span><span class="p">;</span>


    dnssec-enable yes<span class="p">;</span>
    //dnssec-validation yes<span class="p">;</span>

    /*
     * As of <span class="nb">bind</span> <span class="m">9</span>.8.0:
     * <span class="s2">"If the root key provided has expired,</span>
<span class="s2">     * named will log the expiration and validation will not work."</span>
     */
    dnssec-validation auto<span class="p">;</span>

    /* <span class="k">if</span> you have problems and are behind a firewall: */
    //query-source address * port <span class="m">53</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>

logging <span class="o">{</span>
    channel default_log <span class="o">{</span>
        file <span class="s2">"/var/log/named/named.log"</span> versions <span class="m">5</span> size 50M<span class="p">;</span>
        print-time yes<span class="p">;</span>
        print-severity yes<span class="p">;</span>
        print-category yes<span class="p">;</span>
    <span class="o">}</span><span class="p">;</span>

    category default <span class="o">{</span> default_log<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
    category general <span class="o">{</span> default_log<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>

include <span class="s2">"/etc/bind/rndc.key"</span><span class="p">;</span>
controls <span class="o">{</span>
    inet <span class="m">127</span>.0.0.1 port <span class="m">953</span> allow <span class="o">{</span> <span class="m">127</span>.0.0.1/32<span class="p">;</span> ::1/128<span class="p">;</span> <span class="o">}</span> keys <span class="o">{</span> <span class="s2">"rndc-key"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>

zone <span class="s2">"."</span> in <span class="o">{</span>
    <span class="nb">type</span> hint<span class="p">;</span>
    file <span class="s2">"/var/bind/named.cache"</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>

zone <span class="s2">"ghome"</span> IN <span class="o">{</span>
    <span class="nb">type</span> master<span class="p">;</span>
    file <span class="s2">"pri/ghome.zone"</span><span class="p">;</span>
    notify no<span class="p">;</span>
<span class="o">}</span><span class="p">;</span>

zone <span class="s2">"0.168.192.in-addr.arpa"</span> IN <span class="o">{</span>
    <span class="nb">type</span> master<span class="p">;</span>
    file <span class="s2">"pri/0.168.192.in-addr.arpa.zone"</span><span class="p">;</span>
    notify no<span class="p">;</span>
<span class="o">}</span><span class="p">;</span>

zone <span class="s2">"6.168.192.in-addr.arpa"</span> IN <span class="o">{</span>
        <span class="nb">type</span> master<span class="p">;</span>
        file <span class="s2">"pri/6.168.192.in-addr.arpa.zone"</span><span class="p">;</span>
        notify no<span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
</pre></div>
<ul>
<li>file: pri/ghome.zone</li>
</ul>
<div class="highlight"><pre><span></span><span class="nv">$TTL</span> 1W
@       IN      SOA     ns.ghome. root.ghome.  <span class="o">(</span>
                                      <span class="m">2018030901</span> <span class="p">;</span> Serial
                                      <span class="m">28800</span>      <span class="p">;</span> Refresh
                                      <span class="m">14400</span>      <span class="p">;</span> Retry
                                      <span class="m">604800</span>     <span class="p">;</span> Expire - <span class="m">1</span> week
                                      <span class="m">86400</span> <span class="o">)</span>    <span class="p">;</span> Minimum

ghome.          IN      NS      ns.ghome.
ns.ghome.       IN      A       <span class="m">192</span>.168.0.199

<span class="p">;</span> private host
router  IN      A       <span class="m">192</span>.168.0.1
printer IN      A       <span class="m">192</span>.168.0.250
lhome   IN      A       <span class="m">192</span>.168.0.2
ghome1  IN      A       <span class="m">192</span>.168.0.5
ghome2  IN      A       <span class="m">192</span>.168.6.1
air     IN      A       <span class="m">192</span>.168.0.10
win     IN      A       <span class="m">192</span>.168.0.18
mini    IN      A       <span class="m">192</span>.168.0.199
</pre></div>
<ul>
<li>file: pri/0.168.192.in-addr.arpa.zone </li>
</ul>
<div class="highlight"><pre><span></span><span class="nv">$TTL</span> 1W
@       IN      SOA     ghome. root.ghome.  <span class="o">(</span>
                                      <span class="m">2018030901</span> <span class="p">;</span> Serial
                                      <span class="m">28800</span>      <span class="p">;</span> Refresh
                                      <span class="m">14400</span>      <span class="p">;</span> Retry
                                      <span class="m">604800</span>     <span class="p">;</span> Expire - <span class="m">1</span> week
                                      <span class="m">86400</span> <span class="o">)</span>    <span class="p">;</span> Minimum

ghome.  IN      NS      ns.ghome.

<span class="p">;</span> private hosts reverse lookup
<span class="m">1</span>   PTR router.ghome.
<span class="m">10</span>  PTR air.ghome.
<span class="m">18</span>  PTR win.ghome.
<span class="m">199</span> PTR mini.ghome.
</pre></div>
<ul>
<li>file pri/6.168.192.in-addr.arpa.zone</li>
</ul>
<div class="highlight"><pre><span></span><span class="nv">$TTL</span> 1W
@       IN      SOA     ghome. root.ghome.  <span class="o">(</span>
                                      <span class="m">2018030901</span> <span class="p">;</span> Serial
                                      <span class="m">28800</span>      <span class="p">;</span> Refresh
                                      <span class="m">14400</span>      <span class="p">;</span> Retry
                                      <span class="m">604800</span>     <span class="p">;</span> Expire - <span class="m">1</span> week
                                      <span class="m">86400</span> <span class="o">)</span>    <span class="p">;</span> Minimum

        IN      NS      ghome.

<span class="p">;</span> private hosts reverse lookup
<span class="m">1</span>       PTR     ghome2.ghome.
</pre></div>
<h3 id="iptables rules"><span class="caps">IPTABLES</span> <span class="caps">RULES</span></h3>
<div class="highlight"><pre><span></span>iptables -A INPUT -p udp --sport <span class="m">53</span> -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A INPUT -p udp --dport <span class="m">53</span> -j ACCEPT
iptables -A INPUT -p tcp --dport <span class="m">53</span> -j ACCEPT
</pre></div>
<h3 id="te bie shuo ming">特别说明</h3>
<p>如过有其他NAT的网段(如:192.168.6.0/24), 加入这一行 192.168.6.0/24; 到trusted。</p>
<div class="highlight"><pre><span></span>acl <span class="s2">"trusted"</span> <span class="o">{</span>
    <span class="m">127</span>.0.0.0/8<span class="p">;</span>
    ::1/128<span class="p">;</span>
    <span class="m">192</span>.168.0.0/24<span class="p">;</span>
    <span class="m">192</span>.168.6.0/24<span class="p">;</span>  
<span class="o">}</span><span class="p">;</span>
</pre></div>
            
            
            <hr/>
<section>
    <h2>Related Posts</h2>
<ul class="related-posts-list">
<li><a href="./linux-bluetooth-lan-ya.html" title="Linux Bluetooth / 蓝牙">Linux Bluetooth / 蓝牙</a></li>
<li><a href="./ipv6.html" title="IPv6">IPv6</a></li>
<li><a href="./zhuang-ji.html" title="装机">装机</a></li>
<li><a href="./ebuild.html" title="Ebuild">Ebuild</a></li>
<li><a href="./freenas.html" title="Freenas">Freenas</a></li>
</ul>
<hr />
</section>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2018-03-09T18:30:08+08:00">Mar 9, 2018</time>

<h4>Last Updated</h4>
<time datetime="2018-03-09T18:30:08+08:00">Mar 9, 2018</time>

            <h4>Category</h4>
            <a class="category-link" href="./categories.html#tech-ref">Tech</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="./tags.html#dns-ref">dns
                    <span>1</span>
</a></li>
                <li><a href="./tags.html#tech-ref">tech
                    <span>85</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="https://slashdot.org/" title="My IT新闻Slashdot Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-it新闻slashdot sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="https://github.com/Pelican-Elegant/elegant/" title="Theme Elegant Home Page">Elegant</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    
    </body>
    <!-- Theme: Elegant built for Pelican
    License : MIT -->
</html>