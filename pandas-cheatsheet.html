<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Walter" />
        <meta name="copyright" content="Walter" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="tech, Tech, " />

<meta property="og:title" content="Pandas CheatSheet "/>
<meta property="og:url" content="./pandas-cheatsheet.html" />
<meta property="og:description" content="df : DataFrame s : Series 导入数据 pd.read_csv(static) # 读入csv文件 pd.read_table(static) # From a delimited text file (like TSV) pd.read_excel(static) pd.read_sql(query, connection_object) # 从SQl表或者数据库读入 pd.read_json(json_string) # Reads from a JSON formatted string, URL or file. pd.read_html(url) # Parses an html URL, string or file and …" />
<meta property="og:site_name" content="Just MEMO" />
<meta property="og:article:author" content="Walter" />
<meta property="og:article:published_time" content="2018-02-11T19:45:43+08:00" />
<meta property="og:article:modified_time" content="2018-02-11T19:45:43+08:00" />
<meta name="twitter:title" content="Pandas CheatSheet ">
<meta name="twitter:description" content="df : DataFrame s : Series 导入数据 pd.read_csv(static) # 读入csv文件 pd.read_table(static) # From a delimited text file (like TSV) pd.read_excel(static) pd.read_sql(query, connection_object) # 从SQl表或者数据库读入 pd.read_json(json_string) # Reads from a JSON formatted string, URL or file. pd.read_html(url) # Parses an html URL, string or file and …">

        <title>Pandas CheatSheet  · Just MEMO
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="./theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/custom.css" media="screen">


    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="./"><span class=site-name>Just MEMO</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href=".">Home</a></li>
                            <li ><a href="./categories.html">Categories</a></li>
                            <li ><a href="./tags.html">Tags</a></li>
                            <li ><a href="./archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="./search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="./pandas-cheatsheet.html"> Pandas&nbsp;CheatSheet  </a></h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div id="toc"><ul><li><a class="toc-href" href="#dao ru shu ju" title="导入数据">导入数据</a></li><li><a class="toc-href" href="#dao chu shu ju" title="导出数据">导出数据</a></li><li><a class="toc-href" href="#chuang jian dui xiang" title="创建对象">创建对象</a></li><li><a class="toc-href" href="#guan cha shu ju" title="观察数据">观察数据</a></li><li><a class="toc-href" href="#selection / shu ju qie pian" title="SELECTION /&nbsp;数据切片">SELECTION /&nbsp;数据切片</a></li><li><a class="toc-href" href="#shu ju qing xi" title="数据清洗">数据清洗</a><ul><li><a class="toc-href" href="#lie gai ming" title="列改名">列改名</a></li><li><a class="toc-href" href="#shi fou wei kong" title="是否为空">是否为空</a></li><li><a class="toc-href" href="#chu li kong shu ju  nan" title="处理空数据&nbsp;NaN">处理空数据&nbsp;NaN</a></li></ul></li><li><a class="toc-href" href="#guo lu ,pai xu ,fen zu_1" title="过滤，排序，分组">过滤，排序，分组</a></li><li><a class="toc-href" href="#zu he" title="组合">组合</a><ul><li><a class="toc-href" href="#append" title="append">append</a></li><li><a class="toc-href" href="#concat" title="concat">concat</a></li><li><a class="toc-href" href="#append_1" title="append">append</a></li><li><a class="toc-href" href="#merge" title="merge">merge</a></li></ul></li><li><a class="toc-href" href="#statistics_1" title="STATISTICS">STATISTICS</a></li><li><a class="toc-href" href="#ri qi he shi jian" title="日期和时间">日期和时间</a></li><li><a class="toc-href" href="#shu ju ku" title="数据库">数据库</a><ul><li><a class="toc-href" href="#mongodb" title="MongoDB">MongoDB</a></li></ul></li></ul></div>
        </nav>
    </div>
    <div class="span8 article-content">

            
            <p><strong> df : DataFrame </strong>
<strong> s  : Series </strong></p>
<h3 id="dao ru shu ju">导入数据</h3>
<div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">static</span><span class="p">)</span> <span class="c1"># 读入csv文件</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">static</span><span class="p">)</span> <span class="c1"># From a delimited text  file (like TSV)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">static</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">connection_object</span><span class="p">)</span> <span class="c1"># 从SQl表或者数据库读入</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">json_string</span><span class="p">)</span> <span class="c1"># Reads from a JSON formatted string, URL or file.</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="c1"># Parses an html URL, string or file and extracts tables to a list of dataframes</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_clipboard</span><span class="p">()</span> <span class="c1"># Takes the contents of your clipboard and passes it to read_table(), pd.DataFrame(dict), From a dict, keys fo</span>
</pre></div>
<h3 id="dao chu shu ju">导出数据</h3>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">static</span><span class="p">)</span> <span class="c1"># Writes to a CSV file</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">static</span><span class="p">)</span> <span class="c1"># Writes to an Excel file</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">connection_object</span><span class="p">)</span> <span class="c1"># Writes to a SQL table</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">static</span><span class="p">)</span> <span class="c1"># Writes to a file in JSON format</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">static</span><span class="p">)</span> <span class="c1"># Saves as an HTML table</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_clipboard</span><span class="p">()</span> <span class="c1"># Writes to the clipboard</span>
</pre></div>
<h3 id="chuang jian dui xiang">创建对象</h3>
<div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span> <span class="c1"># From dict</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span> <span class="c1"># 20row x 5col</span>
<span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span> <span class="c1"># Create a series from an iterable my_list</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_rage</span><span class="p">(</span><span class="s1">'1900/1/30'</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># Add a date index</span>
</pre></div>
<h3 id="guan cha shu ju">观察数据</h3>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span> 
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span> <span class="c1"># Index, Datatype and Memory infomation</span>
<span class="n">s</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="c1"># View unique values and counts</span>
<span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">value_counts</span><span class="p">)</span> <span class="c1"># Unique and counts for all columns</span>
</pre></div>
<h3 id="selection / shu ju qie pian"><span class="caps">SELECTION</span> / 数据切片</h3>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="c1"># Returns column with label col as Series</span>
<span class="n">df</span><span class="p">[[</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">]]</span> <span class="c1"># Returns Columns as a new DataFrame</span>

<span class="n">s</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Selection by position</span>
<span class="n">s</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="c1"># Selection by index value</span>

<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">'000001'</span><span class="p">]</span> <span class="c1"># Selection by index value</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="c1"># First row</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># First element of first column</span>
</pre></div>
<h3 id="shu ju qing xi">数据清洗</h3>
<h4 id="lie gai ming">列改名</h4>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># Mass renaming of columns</span>
<span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">'old_name'</span><span class="p">:</span> <span class="s1">'new_ name'</span><span class="p">})</span> <span class="c1"># Selective renaming</span>
<span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'column_one'</span><span class="p">)</span> <span class="c1"># Changes the index</span>
<span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># Mass renaming of index</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span><span class="s1">'b'</span><span class="p">,</span><span class="s1">'c'</span><span class="p">]</span> <span class="c1"># Renames columns</span>
</pre></div>
<h4 id="shi fou wei kong">是否为空</h4>
<div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
<span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</pre></div>
<h4 id="chu li kong shu ju  nan">处理空数据 NaN</h4>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Drop 所有的列/columns 中的Null</span>
<span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">thresh</span><span class="o">=</span><span class="n">n</span><span class="p">)</span> <span class="c1"># Drops all rows have have less than n non null values</span>

<span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># Replaces all null values with x</span>
<span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">meithod</span><span class="o">=</span><span class="s1">'ffill'</span><span class="p">)</span> <span class="c1">#用前值填入NaN</span>
<span class="n">s</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="c1"># Replaces all null values with the mean (mean can be replaced with almost any function from the statistics section)</span>

<span class="n">s</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="c1"># Converts the datatype of the series to float</span>
<span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">'one'</span><span class="p">)</span> <span class="c1"># Replaces all values equal to 1 with 'one'</span>
<span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="s1">'one'</span><span class="p">,</span><span class="s1">'three'</span><span class="p">])</span> <span class="c1"># Replaces all 1 with 'one' and 3 with 'three'</span>
</pre></div>
<h3 id="guo lu ,pai xu ,fen zu_1">过滤，排序，分组</h3>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span> <span class="c1"># Rows where the col column is greater than 0.5</span>
<span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.7</span><span class="p">)]</span> <span class="c1"># Rows where 0.7 &gt; col &gt; 0.5</span>
<span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">col1</span><span class="p">)</span> <span class="c1"># Sorts values by col1 in ascending order </span>
<span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">col2</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="c1"># Sorts values by col2 in descending order</span>
<span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="n">col1</span><span class="p">,</span><span class="n">col2</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">])</span> <span class="c1"># Sorts values by col1 in ascending order then col2 in descending order</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="c1"># Returns a groupby object for values from one column</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">col1</span><span class="p">,</span><span class="n">col2</span><span class="p">])</span> <span class="c1"># Returns a groupby object values from multiple columns</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">col1</span><span class="p">)[</span><span class="n">col2</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1"># Returns the mean of the values in col2 , grouped by the values in col1 (mean can be replaced with almost any function from the statistics section)</span>
<span class="n">df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">col1</span><span class="p">,</span><span class="n">values</span><span class="o">=</span> <span class="p">[</span><span class="n">col2</span><span class="p">,</span><span class="n">col3</span><span class="p">],</span><span class="n">aggfunc</span><span class="o">=</span><span class="n">mean</span><span class="p">)</span> <span class="c1"># Creates a pivot table that groups by col1 and calculates the mean of col2 and col3</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">col1</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span> <span class="c1"># Finds the average across all columns for every unique column 1 group</span>
<span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span> <span class="c1"># Applies a function across each column</span>
<span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Applies a function across each row</span>
</pre></div>
<h3 id="zu he">组合</h3>
<h4 id="append">append</h4>
<div class="highlight"><pre><span></span><span class="n">df1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span> <span class="c1"># Adds the rows in df1 to the end of df2 (columns should be identical)</span>
</pre></div>
<h4 id="concat">concat</h4>
<div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Adds the columns in df1 to the end of df2 (rows should be identical)</span>
</pre></div>
<h4 id="append_1">append</h4>
<div class="highlight"><pre><span></span><span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="n">col1</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">'inner'</span><span class="p">)</span> <span class="c1"># SQL-style  joins the columns in df1 with the columns on df2 where the rows for col have identical values.  how can be one of 'left' , 'right' , 'outer' , 'inner'</span>
</pre></div>
<h4 id="merge">merge</h4>
<ol>
<li>merge的时候，最好先清理掉两个df中column名字重复的column，只保留用于merge的key。</li>
<li>这个key如果是索引，就式on=’left_index’</li>
<li><code>inner</code>是交集，<code>outer</code>是并集</li>
</ol>
<div class="highlight"><pre><span></span><span class="n">df_left</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_left</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">'code'</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">'inner'</span><span class="p">)</span>
</pre></div>
<h3 id="statistics_1"><span class="caps">STATISTICS</span></h3>
<p><strong> These can all be applied to a series as well. </strong></p>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span> <span class="c1"># Summary statistics for numerical columns</span>
<span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1"># Returns the mean of all columns </span>
<span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span> <span class="c1"># Returns the correlation between columns in a DataFrame</span>
<span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="c1"># Returns the number of non-null values in each DataFrame column</span>
<span class="n">df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="c1"># Returns the highest value in each column</span>
<span class="n">df</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="c1"># Returns the lowest value in each column</span>
<span class="n">df</span><span class="o">.</span><span class="n">median</span><span class="p">()</span> <span class="c1"># Returns the median of each column</span>
<span class="n">df</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="c1"># Returns the standard deviation of each column</span>
</pre></div>
<h3 id="ri qi he shi jian">日期和时间</h3>
<div class="highlight"><pre><span></span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_value</span><span class="p">,</span> <span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">Z'</span><span class="p">)</span> <span class="c1"># data_value='1994-03-31T00:00:00.000Z'  output= datetime.datetime(1994, 3, 31, 0, 0)</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">'</span><span class="p">)</span>
<span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">open_time</span> <span class="o">=</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">'</span><span class="p">))</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">34200</span><span class="p">)</span> <span class="c1"># 获得当天开盘时间</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="c1"># 时间比较</span>
</pre></div>
<h3 id="shu ju ku">数据库</h3>
<h4 id="mongodb">MongoDB</h4>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pymongo</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="s1">'127.0.0.1'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">27017</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">get_tick_data</span><span class="p">(</span><span class="s1">'600848'</span><span class="p">,</span><span class="n">date</span><span class="o">=</span><span class="s1">'2014-12-22'</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tickdata</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">'records'</span><span class="p">)))</span>
</pre></div>
<div class="highlight"><pre><span></span> <span class="c1"># 将日期格式 [{ ... u'date': u'1994-03-31T00:00:00.000Z'...}]</span>
 <span class="c1"># 转换成 mongodb 的日期格式 [{ ... u'date': datetime.datetime(1994, 3, 31, 0, 0) ...}]</span>
 <span class="c1"># 并存入数据库</span>

 <span class="k">def</span> <span class="nf">transdate</span><span class="p">(</span><span class="n">dict_</span><span class="p">):</span>
     <span class="s1">'将日期格式转换成mongodb的格式'</span>
     <span class="n">dict_</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dict_</span><span class="p">[</span><span class="s1">'date'</span><span class="p">],</span> <span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">Z'</span><span class="p">)</span>
     <span class="k">return</span> <span class="n">dict_</span>

 <span class="n">records</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">'records'</span><span class="p">,</span> <span class="n">date_format</span><span class="o">=</span><span class="s1">'iso'</span><span class="p">))</span>
 <span class="n">records</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">transdate</span><span class="p">,</span> <span class="n">records</span><span class="p">)</span>
 <span class="n">table</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
</pre></div>
            
            
            <hr/>
<section>
    <h2>Related Posts</h2>
<ul class="related-posts-list">
<li><a href="./linux-bluetooth-lan-ya.html" title="Linux Bluetooth / 蓝牙">Linux Bluetooth / 蓝牙</a></li>
<li><a href="./ipv6.html" title="IPv6">IPv6</a></li>
<li><a href="./zhuang-ji.html" title="装机">装机</a></li>
<li><a href="./ebuild.html" title="Ebuild">Ebuild</a></li>
<li><a href="./freenas.html" title="Freenas">Freenas</a></li>
</ul>
<hr />
</section>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2018-02-11T19:45:43+08:00">Feb 11, 2018</time>

<h4>Last Updated</h4>
<time datetime="2018-02-11T19:45:43+08:00">Feb 11, 2018</time>

            <h4>Category</h4>
            <a class="category-link" href="./categories.html#tech-ref">Tech</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="./tags.html#tech-ref">tech
                    <span>85</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="https://slashdot.org/" title="My IT新闻Slashdot Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-it新闻slashdot sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="https://github.com/Pelican-Elegant/elegant/" title="Theme Elegant Home Page">Elegant</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    
    </body>
    <!-- Theme: Elegant built for Pelican
    License : MIT -->
</html>