<!DOCTYPE html>
<html>
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie-edge">

    
    
    <link rel="stylesheet" href="//192.168.0.199:1313/sass/main.min.25934bb03db303dfa541f621fc29b24509d8e2c2e39a063de4a77a16ab2fec19.css">

</head>

    
<head>
    
    

    
    
    <link href="//192.168.0.199:1313/css/section_number/section_number.css" rel="stylesheet" type="text/css">
    
</head>

    <body>

    <h1>Freenas</h1>
    <p>Wed Apr 17, 2019</p>
    
    <a class="tag tag--primary tag--small"   href="//192.168.0.199:1313/"><font color="green">Home</font></a>

    
        
           <a class="tag tag--primary tag--small" href="//192.168.0.199:1313/tags/nas">nas</a>
        
    

    <hr><br>
<nav id="TableOfContents">
<ul>
<li><a href="#terminal-console">Terminal / Console</a>
<ul>
<li><a href="#step-one">Step one</a></li>
<li><a href="#step-two">Step two</a></li>
</ul></li>
<li><a href="#jail">Jail</a>
<ul>
<li><a href="#errors">Errors</a></li>
<li><a href="#jail-initialize">Jail initialize</a></li>
<li><a href="#piwigo">Piwigo</a>
<ul>
<li><a href="#php72-fpm">php72-fpm</a></li>
<li><a href="#mysql-server">mysql server</a></li>
</ul></li>
<li><a href="#xx-net">xx-net</a></li>
</ul></li>
<li><a href="#encrypt">encrypt</a></li>
<li><a href="#mount">mount</a>
<ul>
<li><a href="#from-gentoo-mount-freenas-nfs-server">From Gentoo mount freenas nfs server</a></li>
</ul></li>
<li><a href="#my-freenas-crt-download">My freenas crt download</a></li>
</ul></li>
</ul>
</nav><article>
    

<h2 id="terminal-console">Terminal / Console</h2>

<p>对普通永户和root此方法都适用</p>

<h3 id="step-one">Step one</h3>

<p>%filename: ~/.login_conf</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">me:<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        :charset<span style="color:#f92672">=</span>UTF-8:<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        :lang<span style="color:#f92672">=</span>zh_CN.UTF-8:</code></pre></div>
<h3 id="step-two">Step two</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cd
cp .profile .bash_profile</code></pre></div>
<p>然后再最后添加如下内容:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">PS1<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;\e[0;32m[\u@\h:\e[m\e[1;33m\w\e[m\e[0;32m]\e[m &#34;</span>
<span style="color:#66d9ef">case</span> <span style="color:#e6db74">`</span>id -u<span style="color:#e6db74">`</span> in
      *<span style="color:#f92672">)</span> PS1<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>PS1<span style="color:#e6db74">}</span>$<span style="color:#e6db74"> &#34;</span>;;
<span style="color:#66d9ef">esac</span>

alias ls<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ls -G&#39;</span>;</code></pre></div>
<h2 id="jail">Jail</h2>

<h3 id="errors">Errors</h3>

<ul>
<li><p>Metadata corrupt after fetch</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">rm -fr /var/db/portsnap/*
portsnap fetch</code></pre></div></li>
</ul>

<h3 id="jail-initialize">Jail initialize</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pkg install screen 
pkg install bash
add whell acount: adduser
enable sshd 
port fetch</code></pre></div>
<h3 id="piwigo">Piwigo</h3>

<h4 id="php72-fpm">php72-fpm</h4>

<ul>
<li><p>Config
%filename: /usr/local/etc/php-fpm.d/www.conf</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">;修改一下内容
user <span style="color:#f92672">=</span> www
group <span style="color:#f92672">=</span> www
listen <span style="color:#f92672">=</span> /var/run/php72-fpm.sock
listen.owner <span style="color:#f92672">=</span> www
listen.group <span style="color:#f92672">=</span> www
listen.mode <span style="color:#f92672">=</span> <span style="color:#ae81ff">0660</span></code></pre></div></li>

<li><p>Nginx</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">server <span style="color:#f92672">{</span>
listen <span style="color:#ae81ff">0</span>.0.0.0;
server_name piwigo;
access_log  /var/log/nginx/access.log;
error_log  /var/log/nginx/error.log;

root /usr/local/www/nginx;
<span style="color:#75715e">#root /usr/local/www/piwigo;</span>
<span style="color:#75715e"># php config let nginx talk to php socket</span>
location ~ <span style="color:#f92672">[</span>^/<span style="color:#f92672">]</span><span style="color:#ae81ff">\.</span>php<span style="color:#f92672">(</span>/|$<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    fastcgi_split_path_info ^<span style="color:#f92672">(</span>.+?<span style="color:#ae81ff">\.</span>php<span style="color:#f92672">)(</span>/.*<span style="color:#f92672">)</span>$;
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>!-f $document_root$fastcgi_script_name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">404</span>;
    <span style="color:#f92672">}</span>

    <span style="color:#75715e"># Mitigate https://httpoxy.org/ vulnerabilities</span>
    fastcgi_param HTTP_PROXY <span style="color:#e6db74">&#34;&#34;</span>;

    fastcgi_pass unix:/var/run/php72-fpm.sock;
    fastcgi_index index.php;

    <span style="color:#75715e"># include the fastcgi_param setting</span>
    include fastcgi_params;

    <span style="color:#75715e"># SCRIPT_FILENAME parameter is used for PHP FPM determining</span>
    <span style="color:#75715e"># the script name.</span>
    fastcgi_param  SCRIPT_FILENAME   $document_root$fastcgi_script_name;
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span></code></pre></div></li>

<li><p>Autostart</p></li>
</ul>

<p>%filename: /etc/rc.conf</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">php_fpm_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YES&#34;</span></code></pre></div>
<h4 id="mysql-server">mysql server</h4>

<ul>
<li><p>install</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pkg install mysql56-server</code></pre></div></li>
</ul>

<h3 id="xx-net">xx-net</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># pkg install py27-pip</span>
<span style="color:#75715e">#  pip install cryptography interface</span></code></pre></div>
<h2 id="encrypt">encrypt</h2>

<h2 id="mount">mount</h2>

<h3 id="from-gentoo-mount-freenas-nfs-server">From Gentoo mount freenas nfs server</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">emerge -avq nfs-utils
sudo mount  -t nfs <span style="color:#ae81ff">192</span>.168.0.200:/mnt/gnas/500Gphoto /mnt/ntfs -o nolock</code></pre></div>
<h2 id="my-freenas-crt-download">My freenas crt download</h2>

<p><a href="/downloads/tech/gnas.crt">Freenas crt</a></p>

</article>

    <script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10&v=2"></' + 'script>')</script></body>
</html>
