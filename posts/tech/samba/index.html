<!DOCTYPE html>
<html>
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie-edge">

    
    
    <link rel="stylesheet" href="http://memo.eliglad.com:1313/sass/main.min.25934bb03db303dfa541f621fc29b24509d8e2c2e39a063de4a77a16ab2fec19.css">

</head>

    
<head>
    
    

    
    
    <link href="http://memo.eliglad.com:1313/css/section_number/section_number.css" rel="stylesheet" type="text/css">
    
</head>

    <body>

    <h1>Samba</h1>
    <p>Sat Nov 17, 2018</p>
    
    <a class="tag tag--primary tag--small"   href="http://memo.eliglad.com:1313/"><font color="green">Home</font></a>

    
        
           <a class="tag tag--primary tag--small" href="http://memo.eliglad.com:1313/tags/samba">samba</a>
        
    

    <hr><br>
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#配置文件-smb-conf">配置文件 smb.conf</a></li>
<li><a href="#特别说明">特别说明：</a></li>
<li><a href="#samba-手册-https-www-samba-org-samba-docs-current-man-html-smb-conf-5-html"><a href="https://www.samba.org/samba/docs/current/man-html/smb.conf.5.html">《Samba 手册》</a></a></li>
</ul></li>
</ul></li>
</ul>
</nav><article>
    

<h3 id="配置文件-smb-conf">配置文件 smb.conf</h3>

<p>%filename: /etc/samba/smb.conf</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>global<span style="color:#f92672">]</span>
   workgroup <span style="color:#f92672">=</span> home
   server string <span style="color:#f92672">=</span> mini
   server role <span style="color:#f92672">=</span> standalone server
   hosts allow <span style="color:#f92672">=</span> <span style="color:#ae81ff">192</span>.168.0. <span style="color:#ae81ff">192</span>.168.1. <span style="color:#ae81ff">192</span>.168.6. <span style="color:#ae81ff">127</span>.
   security <span style="color:#f92672">=</span> user
   log file <span style="color:#f92672">=</span> /var/log/samba/log.%m
   max log size <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>
   interfaces <span style="color:#f92672">=</span> <span style="color:#ae81ff">192</span>.168.0.199 <span style="color:#ae81ff">127</span>.0.0.1
   dns proxy <span style="color:#f92672">=</span> no 

<span style="color:#f92672">[</span>homes<span style="color:#f92672">]</span>
   comment <span style="color:#f92672">=</span> Home Directories
   valid users <span style="color:#f92672">=</span> %S
   read only <span style="color:#f92672">=</span> No
   path <span style="color:#f92672">=</span> %H/samba
   create mask <span style="color:#f92672">=</span> <span style="color:#ae81ff">0644</span>
   directory mask <span style="color:#f92672">=</span> <span style="color:#ae81ff">0755</span>
   browseable <span style="color:#f92672">=</span> No

<span style="color:#f92672">[</span>movies<span style="color:#f92672">]</span>
   comment <span style="color:#f92672">=</span> Public Stuff
   path <span style="color:#f92672">=</span> /data/share/movies
   public <span style="color:#f92672">=</span> yes
   writable <span style="color:#f92672">=</span> no
   printable <span style="color:#f92672">=</span> no
   write list <span style="color:#f92672">=</span> @staff
   create mask <span style="color:#f92672">=</span> <span style="color:#ae81ff">0644</span>
   directory mask <span style="color:#f92672">=</span> <span style="color:#ae81ff">0755</span>

<span style="color:#f92672">[</span>public<span style="color:#f92672">]</span>
   comment <span style="color:#f92672">=</span> Public
   path <span style="color:#f92672">=</span> /data/share/public
   public <span style="color:#f92672">=</span> yes
   writable <span style="color:#f92672">=</span> yes 
   printable <span style="color:#f92672">=</span> no
   write list <span style="color:#f92672">=</span> @staff
   create mask <span style="color:#f92672">=</span> <span style="color:#ae81ff">0644</span>
   directory mask <span style="color:#f92672">=</span> <span style="color:#ae81ff">0755</span>
   force user <span style="color:#f92672">=</span> %U  ; Cups的pdf-printer的打印目录在这个public之下，所以加入用户权限。

<span style="color:#f92672">[</span>downloads<span style="color:#f92672">]</span>
   comment <span style="color:#f92672">=</span> Downloads
   path <span style="color:#f92672">=</span> /data/share/downloads
   create mask <span style="color:#f92672">=</span> <span style="color:#ae81ff">0644</span>
   directory mask <span style="color:#f92672">=</span> <span style="color:#ae81ff">0755</span>
   public <span style="color:#f92672">=</span> yes
   writable <span style="color:#f92672">=</span> yes 
   printable <span style="color:#f92672">=</span> no
   guest ok <span style="color:#f92672">=</span> yes
   force user <span style="color:#f92672">=</span> %U</code></pre></div>
<h3 id="特别说明">特别说明：</h3>

<ul>
<li>testparm 用于检查smb.conf的语法是否正确。</li>

<li><p>关于掩码</p>

<ul>
<li><p>create mode</p>

<p>这个配置定义新创建文件的属性。Samba在新建文件时，会把dos文件的权限映射成对应的unix权限，在映射后所得的权限，会与这个参数所定义的值进行与操作。然后再和下面的force create mode进行或操作，这样就得到最终linux下的文件权限。</p></li>

<li><p>force create mode</p>

<p>见上面的描述。相当于此参数所设置的权限位一定会出现在文件属性中。</p></li>

<li><p>directory mode</p>

<p>这个配置与create mode参数类似，只是它是应用在新创建的目录上。Samba在新建目录时，会把dos–&gt;linux映射后的文件属性，与此参数所定义的值相与，再和force directory mode相或，然后按这个值去设置目录属性。</p></li>

<li><p>force directory mode</p>

<p>见上面的描述。相当于此参数中所设置的权限位一定会出现在目录的属性中。
说明一点，上面的create mode和create mask参数是同义词，用哪个都可以；而directory mode和directory mask参数是相同的。</p></li>
</ul></li>
</ul>

<p>当发现Samba中新建的目录/文件权限不正确，例如无法访问某个目录、无法更改文件，就需要检查上面几个值的设置。</p>

<p>另外需要说明的是，上面几个配置项，会和security mask、force security mode、directory security mask、force directory security mode这几个配置项相互作用。这几个带”security”的配置项会影响Windows NT/2000的ACL功能，一般我们不需要设置。</p>

<h3 id="samba-手册-https-www-samba-org-samba-docs-current-man-html-smb-conf-5-html"><a href="https://www.samba.org/samba/docs/current/man-html/smb.conf.5.html">《Samba 手册》</a></h3>

</article>

    <script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10&v=2"></' + 'script>')</script></body>
</html>
